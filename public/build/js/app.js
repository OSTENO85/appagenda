document.addEventListener("DOMContentLoaded",(function(){iniciaApp()}));const reserva={id:window.reservaData?.id||"",nombre:window.reservaData?.nombre||"",tipos:window.reservaData?.tipoId?[{id:String(window.reservaData.tipoId)}]:[],fecha:window.reservaData?.fecha||"",hora:window.reservaData?.hora||"",detalles:window.reservaData?.detalles||"",usuario:document.querySelector("#usuario")?.value||"",estado:window.reservaData?.estado||0};function iniciaApp(){consultarAPI(),idUsuario(),datosReserva()}async function consultarAPI(){const e=await fetch("http://localhost:3000/api/tipos");mostrarTipos(await e.json())}function mostrarTipos(e){e.forEach((e=>{const{id:a,nombre:o}=e,r=document.createElement("P");r.classList.add("nombre-tipo"),r.textContent=o;const t=document.createElement("DIV");t.classList.add("tipo"),t.dataset.idTipo=a,t.onclick=function(){seleccionartipo(e)},t.appendChild(r),document.querySelector("#tipos").appendChild(t)}));const a=reserva.tipos[0]?.id;if(a){document.querySelector(`[data-id-tipo="${a}"]`)&&seleccionartipo({id:a})}}function seleccionartipo(e){reserva.tipos=[e];const{id:a}=e;document.querySelectorAll(".seleccionado").forEach((e=>{e.classList.remove("seleccionado","amarillo","rojo","morado","gris","verde")}));const o=document.querySelector(`[data-id-tipo="${a}"]`);switch(a){case"1":o.classList.add("rojo");break;case"2":o.classList.add("morado");break;case"3":o.classList.add("verde");break;case"4":o.classList.add("amarillo");break;case"5":o.classList.add("gris");break;default:console.warn("ID no reconocido")}o.classList.add("seleccionado")}function idUsuario(){reserva.usuario=document.querySelector("#usuario").value}function datosReserva(){const e=document.querySelector("#nombre");e.value=reserva.nombre,e.addEventListener("input",(function(){reserva.nombre=e.value}));const a=document.querySelector("#fecha");a.value=reserva.fecha,a.addEventListener("input",(function(){reserva.fecha=a.value}));const o=document.querySelector("#hora");o.value=reserva.hora,o.addEventListener("input",(function(){reserva.hora=o.value}));const r=document.querySelector("#detalles");r.value=reserva.detalles,r.addEventListener("input",(function(){reserva.detalles=r.value}));const t=document.querySelector("#estado");t&&(t.value=reserva.estado,t.addEventListener("change",(function(){reserva.estado=parseInt(t.value)})));const s=document.querySelector("#botonReserva");s.value=reserva.id?"Guardar Cambios":"Reservar",s.onclick=reservarFecha}async function reservarFecha(e){if(e.preventDefault(),!validarReserva())return;const{nombre:a,fecha:o,hora:r,detalles:t,tipos:s,usuario:n,estado:i}=reserva,c=s.map((e=>e.id)),d=new FormData;d.append("nombre",a),d.append("fecha",o),d.append("hora",r),d.append("detalles",t),d.append("tipoId",c),d.append("usuarioId",n),d.append("estado",i);const l=await fetch("http://localhost:3000/api/reservas",{method:"POST",body:d});(await l.json()).resultado&&Swal.fire({title:reserva.id?"Reserva actualizada":"Reserva creada",text:reserva.id?"Los cambios fueron guardados correctamente":"Tu reserva se creÃ³ correctamente",icon:"success"}).then((()=>{window.location.reload()}))}function validarReserva(){const{nombre:e,fecha:a,hora:o,detalles:r,tipos:t,usuario:s}=reserva;return""!==e.trim()&&""!==a.trim()&&""!==o.trim()&&""!==r.trim()&&0!==t.length&&""!==s.trim()||(Swal.fire({title:"Campos incompletos",text:"Por favor completa todos los campos antes de continuar.",icon:"warning"}),!1)}